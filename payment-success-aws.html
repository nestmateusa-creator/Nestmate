<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Successful - NestMate</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1491.0.min.js"></script>
  <style>
    body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(135deg,#e0e7ff,#f8fafc);min-height:100vh;display:flex;align-items:center;justify-content:center;color:#0f172a}
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,.08);padding:28px;max-width:520px;width:92%}
    .ok{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;font-size:30px}
    h1{margin:6px 0 4px;font-size:22px}
    .muted{color:#64748b}
    .plan{margin:14px 0;padding:14px;border:1px dashed #cbd5e1;border-radius:12px;background:#f8fafc}
    .cta{display:inline-block;margin-top:16px;background:#2563eb;color:#fff;text-decoration:none;padding:12px 18px;border-radius:10px;font-weight:700}
  </style>
</head>
<body>
  <div class="card">
    <div class="ok"><i class="fa fa-check"></i></div>
    <h1>Payment successful</h1>
    <div class="muted">We are activating your subscription…</div>
    <div id="plan" class="plan">Detecting plan…</div>
    <a id="go" class="cta" href="#">Continue</a>
  </div>

  <script>
    // Configure AWS (temporary client-side for immediate functionality)
    AWS.config.update({
      region: 'us-east-2',
      accessKeyId: 'AKIAXBLPTGPR44FNAHUL',
      secretAccessKey: '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'
    });
    const ddb = new AWS.DynamoDB.DocumentClient();

      const planMap = {
      '9B600lc6u4oneY50Ch1sQ0M': {key:'basic', name:'Basic (Monthly)', dash:'dashboard-basic-clean.html'},
      'cNi3cx3zY3kj6rzckZ1sQ0R': {key:'basic', name:'Basic (Yearly)', dash:'dashboard-basic-clean.html'},
      '14AeVf4E29IHbLT4Sx1sQ0N': {key:'pro', name:'Pro (Monthly)', dash:'dashboard-basic-clean.html'},
      'bJe6oJ0nMg755nv0Ch1sQ0S': {key:'pro', name:'Pro (Yearly)', dash:'dashboard-basic-clean.html'},
      '9B628t1rQ2gfdU1et71sQ0O': {key:'advanced', name:'Advanced Pro (Monthly)', dash:'dashboard-basic-clean.html'},
      '14AcN7eeC8ED3fn4Sx1sQ0T': {key:'advanced', name:'Advanced Pro (Yearly)', dash:'dashboard-basic-clean.html'},
      '14A9AV2vU1cb3fn4Sx1sQ0Q': {key:'enterprise', name:'Enterprise (Monthly)', dash:'dashboard-basic-clean.html'},
      'aFa4gB8UiaML3fn1Gl1sQ0U': {key:'enterprise', name:'Enterprise (Yearly)', dash:'dashboard-basic-clean.html'}
    };

    function getSelectedPlan() {
      const url = new URL(window.location.href);
      const planKey = url.searchParams.get('plan') || localStorage.getItem('selectedPlan');
      return planMap[planKey] || {key:'basic', name:'Basic', dash:'dashboard-basic-clean.html'};
    }

    async function activateSubscription() {
      const plan = getSelectedPlan();
      document.getElementById('plan').textContent = plan.name;

      // current user info stored by login
      const currentUser = JSON.parse(localStorage.getItem('currentUser')||'null');
      if (!currentUser) {
        document.getElementById('go').href = 'login-aws.html';
        return;
      }

      try {
        await ddb.update({
          TableName: 'nestmate-users',
          Key: { userId: currentUser.userId },
          UpdateExpression: 'SET subscription = :p, subscriptionStatus = :st',
          ExpressionAttributeValues: { ':p': plan.key, ':st': 'active' }
        }).promise();
      } catch (e) { /* proceed anyway for now */ }

      document.getElementById('go').href = plan.dash;
      setTimeout(()=>{ window.location.href = plan.dash; }, 1500);
    }

    activateSubscription();
  </script>
</body>
</html>


